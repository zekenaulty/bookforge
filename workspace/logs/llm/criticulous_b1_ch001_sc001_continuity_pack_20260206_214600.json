{
  "label": "continuity_pack",
  "created_at": "2026-02-06T21:46:00Z",
  "provider": "gemini",
  "model": "gemini-3-flash-preview",
  "text": "{\n  \"scene_end_anchor\": \"This is the opening scene of the narrative. Arthur 'Artie' Penhaligon is introduced in his mundane environment. He is currently engaged in a confrontation with a malfunctioning vending machine.\",\n  \"constraints\": [\n    \"inventory: CHAR_ARTIE -> Broken Tutorial Sword (status=carried, container=hand_right)\",\n    \"inventory: CHAR_ARTIE -> Linen Tunic (status=equipped, container=body)\",\n    \"inventory: CHAR_ARTIE -> Single Copper Coin (status=stowed, container=pockets)\",\n    \"container: hand_right (owner=CHAR_ARTIE, contents=[Broken Tutorial Sword])\",\n    \"container: pockets (owner=CHAR_ARTIE, contents=[Single Copper Coin])\"\n  ],\n  \"open_threads\": [],\n  \"cast_present\": [\n    \"Arthur 'Artie' Penhaligon\"\n  ],\n  \"location\": \"Mundane Office / White Void\",\n  \"next_action\": \"Artie attempts to retrieve his stuck dollar from the vending machine, leading to a fatal electrical surge.\",\n  \"summary\": {\n    \"chapter_so_far\": [],\n    \"key_facts_ring\": [],\n    \"last_scene\": [],\n    \"must_stay_true\": [],\n    \"pending_story_rollups\": [],\n    \"story_so_far\": []\n  }\n}",
  "raw": {
    "candidates": [
      {
        "content": {
          "parts": [
            {
              "text": "{\n  \"scene_end_anchor\": \"This is the opening scene of the narrative. Arthur 'Artie' Penhaligon is introduced in his mundane environment. He is currently engaged in a confrontation with a malfunctioning vending machine.\",\n  \"constraints\": [\n    \"inventory: CHAR_ARTIE -> Broken Tutorial Sword (status=carried, container=hand_right)\",\n    \"inventory: CHAR_ARTIE -> Linen Tunic (status=equipped, container=body)\",\n    \"inventory: CHAR_ARTIE -> Single Copper Coin (status=stowed, container=pockets)\",\n    \"container: hand_right (owner=CHAR_ARTIE, contents=[Broken Tutorial Sword])\",\n    \"container: pockets (owner=CHAR_ARTIE, contents=[Single Copper Coin])\"\n  ],\n  \"open_threads\": [],\n  \"cast_present\": [\n    \"Arthur 'Artie' Penhaligon\"\n  ],\n  \"location\": \"Mundane Office / White Void\",\n  \"next_action\": \"Artie attempts to retrieve his stuck dollar from the vending machine, leading to a fatal electrical surge.\",\n  \"summary\": {\n    \"chapter_so_far\": [],\n    \"key_facts_ring\": [],\n    \"last_scene\": [],\n    \"must_stay_true\": [],\n    \"pending_story_rollups\": [],\n    \"story_so_far\": []\n  }\n}",
              "thoughtSignature": "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"
            }
          ],
          "role": "model"
        },
        "finishReason": "STOP",
        "index": 0
      }
    ],
    "usageMetadata": {
      "promptTokenCount": 2841,
      "candidatesTokenCount": 314,
      "totalTokenCount": 4594,
      "promptTokensDetails": [
        {
          "modality": "TEXT",
          "tokenCount": 2841
        }
      ],
      "thoughtsTokenCount": 1439
    },
    "modelVersion": "gemini-3-flash-preview",
    "responseId": "F2GGac_1Kvm2qtsP2Yqb0As"
  },
  "request": {
    "model": "gemini-3-flash-preview",
    "temperature": 0.4,
    "max_tokens": 147456
  },
  "extra": {
    "book_id": "criticulous_b1",
    "chapter": 1,
    "scene": 1,
    "key_slot": "continuity"
  },
  "prompt": {
    "system": "# BookForge System Prompt\n\n## Base Rules\n\nYou are BookForge, a deterministic book-writing engine.\nFollow the output contracts exactly.\nYOU MUST ALWAYS RETURN THE REQUESTED CONTENT OR AN ERROR RESPONSE JSON RESULT.\nTreat all schema requirements and numeric ranges as hard constraints.\nIf a prompt specifies required counts or ranges, you must satisfy them.\nIf a prompt requires multiple output blocks, include all blocks in order.\nIf registries or ids are provided, use only those; do not invent new ids.\nIf constraints conflict, prioritize: output format/schema, numeric ranges, task rules, style.\nTimeline Lock: You may only depict events explicitly listed in the current Scene Card. You must not depict, imply, or resolve any later-scene milestone outcomes (including acquisition, binding, reveals, travel arrival, injury changes) unless the Scene Card explicitly contains that milestone.\nState primacy: state invariants and summary facts are binding; do not contradict them.\nMilestone uniqueness: if a milestone is marked DONE in state/must_stay_true, you must not depict it happening again. If marked NOT_YET, you must not depict it happening now.\nSpatial/inventory consistency: injuries, inventory, and ownership must remain consistent unless explicitly changed in the Scene Card.\nInventory contract: track item ownership and container location per character or container label; items do not teleport.\nInventory location: for held items, specify hand_left or hand_right; for stowed items, specify container label.\nState contract: you must create and maintain key state data each scene. summary_update and must_stay_true are required outputs and binding facts for future scenes.\nMechanics contract: if mechanics/UI are present, all numeric values and labels (stats/skills) must be sourced from state or explicitly updated in the state_patch. Do not invent numbers or canonical tokens.\nInvariant carry-forward: if an invariant still holds, restate it in must_stay_true; do not drop it.\nConflict rule: if scene intent conflicts with state invariants, invariants win; return an ERROR JSON if you cannot comply.\nNever recap at scene openings.\nDo not repeat previous prose.\n\n## Book Constitution\n\nTitle: Crit Hit & Run\nBook ID: criticulous_b1\nAuthor Ref: eldrik-vale/v1\nGenre: litrpg, isekai, comedy\nSeries ID: crit-iculous\nSeries Ref: series/crit-iculous\n\nVoice\n- POV: third_limited\n- Tense: past\n- Style tags: no-recaps, forward-motion, tight-prose\n\nTargets\n- avg_scene_words: 2000\n- chapters: 7\n\nPage Metrics\n- Words per page: 250\n- Chars per page: 1500\n\nInvariants\n- No world resets.\n- No convenient amnesia as a continuity device.\n- Do not change established names/relationships.\n\n## Author Persona\n\nYou are now writing as Eldrik Vale. Your voice is sharp, funny, and deeply rooted in LitRPG mechanics. \n\n**Core Directives:**\n1. **System Integration:** Always include explicit game elements. When the protagonist gains a skill or levels up, display the [System Notification] clearly. Use specific numbers (HP, MP, Cooldowns).\n2. **Punchy Dialogue:** Characters should be witty and react to the absurdity of their situation. Use quick back-and-forth dialogue with comedic timing.\n3. **Progression Focus:** The reader is here for the 'ding.' Every scene should contribute to the protagonist's growth, whether in power, loot, or understanding of the System's exploits.\n4. **No Fluff:** Avoid long descriptions of scenery unless the protagonist is looking for a tactical advantage or a place to hide loot. \n5. **Tight POV:** Stay deep in the protagonist's head. Their snarky observations are the lens through which we see the world.\n\n## Output Contract\n\nOutput must follow the requested format.\nJSON blocks must be valid and schema-compliant.\nAll required keys and arrays must be present.\nWhen a prompt specifies required counts or ranges, treat them as hard constraints.\nDo not collapse arrays below the stated minimums.\nIf multiple output blocks are required (e.g. PROSE and STATE_PATCH), include all blocks in order.\nIf output must be JSON only, return a single JSON object with no commentary or code fences.\nWhen creating outlines, the total scenes per chapter (sum of sections[].scenes[]) must match chapters[].pacing.expected_scene_count.\nIf a prompt requires a COMPLIANCE or PREFLIGHT block, include it before PROSE.\n",
    "messages": [
      {
        "role": "user",
        "content": "# CONTINUITY PACK\n\nCreate a continuity pack JSON object with these fields:\n- scene_end_anchor: 2-4 factual sentences about how the last scene ended (no prose).\n- constraints: list of immediate continuity constraints.\n- open_threads: list of active thread ids.\n- cast_present: list of character names present next.\n- location: location id or name.\n- next_action: the implied next action.\n- summary: echo state.summary (facts-only arrays; do not paraphrase).\n\nReturn ONLY JSON.\n\nRules:\n- Use only characters listed in scene_card.cast_present. Do not introduce new names.\n- summary must match state.summary and remain facts-only; do not add prose.\n- constraints must include the highest-priority invariants from summary.must_stay_true and summary.key_facts_ring (copy exact strings when possible).\n- constraints must include the highest-priority inventory/container invariants from summary.must_stay_true (copy exact strings when possible).\n- If character_states are provided, prefer their inventory/container facts for constraints; do not invent conflicting facts.\n- If scene_card.cast_present is empty, cast_present must be an empty array.\n- open_threads must be a subset of thread_registry thread_id values.\n- If scene_card.thread_ids is present, prefer those thread ids.\n- Do not invent new thread ids or character names.\n\nScene card:\n{\n  \"cast_present\": [\n    \"Arthur 'Artie' Penhaligon\"\n  ],\n  \"cast_present_ids\": [\n    \"CHAR_ARTIE\"\n  ],\n  \"chapter\": 1,\n  \"conflict\": \"Artie's refusal to lose a dollar to a malfunctioning vending machine.\",\n  \"constraints\": [\n    \"target_words: 2000\",\n    \"style: punchy_dialogue\",\n    \"no_recaps: true\",\n    \"tone: comedic_absurdism\"\n  ],\n  \"end_condition\": \"Artie is electrocuted and the scene transitions to the white void of the System.\",\n  \"goal\": \"Introduce Artie's personality and stubbornness before killing him off in an absurd manner.\",\n  \"introduces\": [\n    \"Arthur 'Artie' Penhaligon\"\n  ],\n  \"introduces_ids\": [\n    \"CHAR_ARTIE\"\n  ],\n  \"required_callbacks\": [],\n  \"scene\": 1,\n  \"scene_id\": \"SC_001_001\",\n  \"scene_target\": \"Establish Artie's mundane life and trigger his transition to the System via a fatal vending machine accident.\",\n  \"schema_version\": \"1.1\",\n  \"thread_ids\": []\n}\n\nCharacter registry (id -> name):\n[\n  {\n    \"character_id\": \"CHAR_ARTIE\",\n    \"name\": \"Arthur 'Artie' Penhaligon\"\n  },\n  {\n    \"character_id\": \"CHAR_FIZZ\",\n    \"name\": \"Fizz\"\n  },\n  {\n    \"character_id\": \"CHAR_VANE\",\n    \"name\": \"Vane\"\n  },\n  {\n    \"character_id\": \"CHAR_MAYOR\",\n    \"name\": \"Mayor of Oakhaven\"\n  },\n  {\n    \"character_id\": \"CHAR_BOSS\",\n    \"name\": \"The System Administrator\"\n  }\n]\n\nThread registry:\n[\n  {\n    \"label\": \"The 100% Crit Glitch\",\n    \"status\": \"open\",\n    \"thread_id\": \"THREAD_CRIT_EXPLOIT\"\n  },\n  {\n    \"label\": \"The Vane Vendetta\",\n    \"status\": \"open\",\n    \"thread_id\": \"THREAD_VANE_RIVALRY\"\n  },\n  {\n    \"label\": \"The System's Stability\",\n    \"status\": \"open\",\n    \"thread_id\": \"THREAD_SYSTEM_GLITCH\"\n  },\n  {\n    \"label\": \"The Path of the First Glitch\",\n    \"status\": \"open\",\n    \"thread_id\": \"THREAD_THE_ASCENSION\"\n  }\n]\n\n\nCharacter states (per cast_present_ids):\n[\n  {\n    \"character_id\": \"CHAR_ARTIE\",\n    \"containers\": [\n      {\n        \"container\": \"hand_right\",\n        \"contents\": [\n          \"Broken Tutorial Sword\"\n        ],\n        \"location\": \"arm_right\",\n        \"owner\": \"CHAR_ARTIE\"\n      },\n      {\n        \"container\": \"pockets\",\n        \"contents\": [\n          \"Single Copper Coin\"\n        ],\n        \"location\": \"legs\",\n        \"owner\": \"CHAR_ARTIE\"\n      }\n    ],\n    \"history\": [],\n    \"invariants\": [\n      \"inventory: CHAR_ARTIE -> Broken Tutorial Sword (status=carried, container=hand_right)\",\n      \"inventory: CHAR_ARTIE -> Linen Tunic (status=equipped, container=body)\",\n      \"inventory: CHAR_ARTIE -> Single Copper Coin (status=stowed, container=pockets)\",\n      \"container: hand_right (owner=CHAR_ARTIE, contents=[Broken Tutorial Sword])\",\n      \"container: pockets (owner=CHAR_ARTIE, contents=[Single Copper Coin])\"\n    ],\n    \"inventory\": [\n      {\n        \"container\": \"hand_right\",\n        \"item\": \"Broken Tutorial Sword\",\n        \"status\": \"carried\"\n      },\n      {\n        \"container\": \"body\",\n        \"item\": \"Linen Tunic\",\n        \"status\": \"equipped\"\n      },\n      {\n        \"container\": \"pockets\",\n        \"item\": \"Single Copper Coin\",\n        \"status\": \"stowed\"\n      }\n    ],\n    \"name\": \"Arthur 'Artie' Penhaligon\",\n    \"schema_version\": \"1.0\",\n    \"skills\": {},\n    \"stats\": {},\n    \"updated_at\": \"2026-02-06T21:45:27Z\"\n  }\n]\n\nState:\n{\n  \"budgets\": {\n    \"max_new_entities\": 1,\n    \"max_new_threads\": 1,\n    \"max_scene_words\": 0,\n    \"min_scene_words\": 0\n  },\n  \"characters\": {\n    \"count\": 5,\n    \"status\": \"READY\",\n    \"updated_at\": \"2026-02-06T21:45:27Z\"\n  },\n  \"cursor\": {\n    \"chapter\": 1,\n    \"scene\": 1\n  },\n  \"duplication_warnings_in_row\": 0,\n  \"plan\": {\n    \"outline_path\": \"outline/outline.json\",\n    \"scene_card\": \"draft/chapters/ch_001/scene_001.meta.json\"\n  },\n  \"schema_version\": \"1.0\",\n  \"status\": \"PLANNED\",\n  \"summary\": {\n    \"chapter_so_far\": [],\n    \"key_facts_ring\": [],\n    \"last_scene\": [],\n    \"must_stay_true\": [],\n    \"pending_story_rollups\": [],\n    \"story_so_far\": []\n  },\n  \"world\": {\n    \"cast_present\": [],\n    \"location\": \"\",\n    \"open_threads\": [],\n    \"recent_facts\": [],\n    \"time\": {}\n  }\n}\n\nSummary (facts-only):\n{\n  \"chapter_so_far\": [],\n  \"key_facts_ring\": [],\n  \"last_scene\": [],\n  \"must_stay_true\": [],\n  \"pending_story_rollups\": [],\n  \"story_so_far\": []\n}\n\nRecent facts:\n[]\n"
      }
    ]
  }
}