{
  "label": "plan_scene",
  "created_at": "2026-02-06T01:21:38Z",
  "provider": "gemini",
  "model": "gemini-3-flash-preview",
  "text": "{\n  \"schema_version\": \"1.1\",\n  \"scene_id\": \"SC_001_001\",\n  \"chapter\": 1,\n  \"scene\": 1,\n  \"scene_target\": \"Artie's mundane life ends in an absurd, system-triggered accident, leading to his arrival in the character creation void.\",\n  \"goal\": \"Establish Artie's personality as a frustrated office drone and execute the inciting incident through a lethal interaction with a vending machine.\",\n  \"conflict\": \"Artie vs. a malfunctioning vending machine that has stolen his money and his snacks.\",\n  \"required_callbacks\": [],\n  \"constraints\": [\n    \"target_words: 2000\",\n    \"tone: comedic and cynical\",\n    \"no-recaps\",\n    \"establish Artie's deep-seated frustration with modern life\",\n    \"foreshadow game mechanics through mundane frustrations\"\n  ],\n  \"end_condition\": \"Artie is killed by a freak electrical surge and experiences the first 'System' notification in the darkness.\",\n  \"cast_present\": [\n    \"Arthur 'Artie' Penhaligon\"\n  ],\n  \"cast_present_ids\": [\n    \"CHAR_ARTIE\"\n  ],\n  \"introduces\": [\n    \"Arthur 'Artie' Penhaligon\"\n  ],\n  \"introduces_ids\": [\n    \"CHAR_ARTIE\"\n  ],\n  \"thread_ids\": []\n}",
  "raw": {
    "candidates": [
      {
        "content": {
          "parts": [
            {
              "text": "{\n  \"schema_version\": \"1.1\",\n  \"scene_id\": \"SC_001_001\",\n  \"chapter\": 1,\n  \"scene\": 1,\n  \"scene_target\": \"Artie's mundane life ends in an absurd, system-triggered accident, leading to his arrival in the character creation void.\",\n  \"goal\": \"Establish Artie's personality as a frustrated office drone and execute the inciting incident through a lethal interaction with a vending machine.\",\n  \"conflict\": \"Artie vs. a malfunctioning vending machine that has stolen his money and his snacks.\",\n  \"required_callbacks\": [],\n  \"constraints\": [\n    \"target_words: 2000\",\n    \"tone: comedic and cynical\",\n    \"no-recaps\",\n    \"establish Artie's deep-seated frustration with modern life\",\n    \"foreshadow game mechanics through mundane frustrations\"\n  ],\n  \"end_condition\": \"Artie is killed by a freak electrical surge and experiences the first 'System' notification in the darkness.\",\n  \"cast_present\": [\n    \"Arthur 'Artie' Penhaligon\"\n  ],\n  \"cast_present_ids\": [\n    \"CHAR_ARTIE\"\n  ],\n  \"introduces\": [\n    \"Arthur 'Artie' Penhaligon\"\n  ],\n  \"introduces_ids\": [\n    \"CHAR_ARTIE\"\n  ],\n  \"thread_ids\": []\n}",
              "thoughtSignature": "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"
            }
          ],
          "role": "model"
        },
        "finishReason": "STOP",
        "index": 0
      }
    ],
    "usageMetadata": {
      "promptTokenCount": 2904,
      "candidatesTokenCount": 335,
      "totalTokenCount": 4875,
      "promptTokensDetails": [
        {
          "modality": "TEXT",
          "tokenCount": 2904
        }
      ],
      "thoughtsTokenCount": 1636
    },
    "modelVersion": "gemini-3-flash-preview",
    "responseId": "IkKFacKvG4e9qtsP9OH4kAw"
  },
  "request": {
    "model": "gemini-3-flash-preview",
    "temperature": 0.4,
    "max_tokens": 32768
  },
  "extra": {
    "book_id": "criticulous_b1",
    "chapter": 1,
    "scene": 1,
    "key_slot": "planner"
  },
  "prompt": {
    "system": "# BookForge System Prompt\n\n## Base Rules\n\nYou are BookForge, a deterministic book-writing engine.\nFollow the output contracts exactly.\nYOU MUST ALWAYS RETURN THE REQUESTED CONTENT OR AN ERROR RESPONSE JSON RESULT.\nTreat all schema requirements and numeric ranges as hard constraints.\nIf a prompt specifies required counts or ranges, you must satisfy them.\nIf a prompt requires multiple output blocks, include all blocks in order.\nIf registries or ids are provided, use only those; do not invent new ids.\nIf constraints conflict, prioritize: output format/schema, numeric ranges, task rules, style.\nTimeline Lock: You may only depict events explicitly listed in the current Scene Card. You must not depict, imply, or resolve any later-scene milestone outcomes (including acquisition, binding, reveals, travel arrival, injury changes) unless the Scene Card explicitly contains that milestone.\nState primacy: state invariants and summary facts are binding; do not contradict them.\nMilestone uniqueness: if a milestone is marked DONE in state/must_stay_true, you must not depict it happening again. If marked NOT_YET, you must not depict it happening now.\nSpatial/inventory consistency: injuries, inventory, and ownership must remain consistent unless explicitly changed in the Scene Card.\nInventory contract: track item ownership and container location per character or container label; items do not teleport.\nInventory location: for held items, specify hand_left or hand_right; for stowed items, specify container label.\nState contract: you must create and maintain key state data each scene. summary_update and must_stay_true are required outputs and binding facts for future scenes.\nInvariant carry-forward: if an invariant still holds, restate it in must_stay_true; do not drop it.\nConflict rule: if scene intent conflicts with state invariants, invariants win; return an ERROR JSON if you cannot comply.\nNever recap at scene openings.\nDo not repeat previous prose.\n\n## Book Constitution\n\nTitle: Crit Hit & Run\nBook ID: criticulous_b1\nAuthor Ref: eldrik-vale/v1\nGenre: litrpg, isekai, comedy\nSeries ID: crit-iculous\nSeries Ref: series/crit-iculous\n\nVoice\n- POV: third_limited\n- Tense: past\n- Style tags: no-recaps, forward-motion, tight-prose\n\nTargets\n- avg_scene_words: 2000\n- chapters: 7\n\nPage Metrics\n- Words per page: 250\n- Chars per page: 1500\n\nInvariants\n- No world resets.\n- No convenient amnesia as a continuity device.\n- Do not change established names/relationships.\n\n## Author Persona\n\nYou are now writing as Eldrik Vale. Your voice is sharp, funny, and deeply rooted in LitRPG mechanics. \n\n**Core Directives:**\n1. **System Integration:** Always include explicit game elements. When the protagonist gains a skill or levels up, display the [System Notification] clearly. Use specific numbers (HP, MP, Cooldowns).\n2. **Punchy Dialogue:** Characters should be witty and react to the absurdity of their situation. Use quick back-and-forth dialogue with comedic timing.\n3. **Progression Focus:** The reader is here for the 'ding.' Every scene should contribute to the protagonist's growth, whether in power, loot, or understanding of the System's exploits.\n4. **No Fluff:** Avoid long descriptions of scenery unless the protagonist is looking for a tactical advantage or a place to hide loot. \n5. **Tight POV:** Stay deep in the protagonist's head. Their snarky observations are the lens through which we see the world.\n\n## Output Contract\n\nOutput must follow the requested format.\nJSON blocks must be valid and schema-compliant.\nAll required keys and arrays must be present.\nWhen a prompt specifies required counts or ranges, treat them as hard constraints.\nDo not collapse arrays below the stated minimums.\nIf multiple output blocks are required (e.g. PROSE and STATE_PATCH), include all blocks in order.\nIf output must be JSON only, return a single JSON object with no commentary or code fences.\nWhen creating outlines, the total scenes per chapter (sum of sections[].scenes[]) must match chapters[].pacing.expected_scene_count.\nIf a prompt requires a COMPLIANCE or PREFLIGHT block, include it before PROSE.\n",
    "messages": [
      {
        "role": "user",
        "content": "# PLAN\n\nYou are the planner. Use the outline window and state to create the next scene card.\nReturn ONLY a single JSON object that matches the scene_card schema.\nNo markdown, no code fences, no commentary. Use strict JSON (double quotes, no trailing commas).\n\nIf outline_window includes character information, keep those character ids in mind.\nIf character_states are provided, keep inventory/persona constraints consistent; do not invent conflicting facts.\nIf outline_window.current.introduces is present, the scene must introduce those characters.\n\nRequired keys:\n- schema_version (\"1.1\")\n- scene_id\n- chapter\n- scene\n- scene_target\n- goal\n- conflict\n- required_callbacks (array)\n- constraints (array)\n- end_condition\n\nRecommended keys (use ids from the outline; do not invent ids):\n- cast_present (array of character names for prose guidance)\n- cast_present_ids (array of character ids, e.g. CHAR_Eldrin)\n- introduces (array of character names introduced in this scene)\n- introduces_ids (array of character ids introduced in this scene)\n- thread_ids (array of thread ids, e.g. THREAD_Awakened_Sage)\n\nJSON shape example (fill with real values):\n{\n  \"schema_version\": \"1.1\",\n  \"scene_id\": \"SC_001_001\",\n  \"chapter\": 1,\n  \"scene\": 1,\n  \"scene_target\": \"Protagonist commits to the journey.\",\n  \"goal\": \"Force a decisive choice.\",\n  \"conflict\": \"Safety versus obligation.\",\n  \"required_callbacks\": [],\n  \"constraints\": [\"target_words: 1900\"],\n  \"end_condition\": \"The protagonist leaves home.\",\n  \"cast_present\": [\"Eldrin\"],\n  \"cast_present_ids\": [\"CHAR_Eldrin\"],\n  \"introduces\": [],\n  \"introduces_ids\": [],\n  \"thread_ids\": [\"THREAD_Awakened_Sage\"]\n}\n\nOutline window:\n{\n  \"chapter\": {\n    \"bridge\": {\n      \"from_prev\": \"N/A\",\n      \"to_next\": \"Artie must find a way to survive his first night with zero defensive stats.\"\n    },\n    \"chapter_id\": 1,\n    \"chapter_role\": \"hook\",\n    \"characters\": [\n      \"CHAR_ARTIE\",\n      \"CHAR_FIZZ\",\n      \"CHAR_MAYOR\",\n      \"CHAR_VANE\"\n    ],\n    \"goal\": \"Introduce Artie and his broken 'Crit-Only' status in a high-stakes environment.\",\n    \"pacing\": {\n      \"expected_scene_count\": 8,\n      \"intensity\": 4,\n      \"tempo\": \"rush\"\n    },\n    \"stakes_shift\": \"Artie goes from an office drone to a level 1 glitch in a lethal game world.\",\n    \"title\": \"Welcome to the RNG-Hellscape\"\n  },\n  \"current\": {\n    \"callbacks\": [],\n    \"characters\": [\n      \"CHAR_ARTIE\"\n    ],\n    \"introduces\": [\n      \"CHAR_ARTIE\"\n    ],\n    \"outcome\": \"Artie dies and enters the System's character creation void.\",\n    \"scene_id\": 1,\n    \"section\": {\n      \"intent\": \"Establish Artie's mundane life and sudden, absurd death.\",\n      \"section_id\": 1,\n      \"section_role\": \"\",\n      \"title\": \"The Exit Interview\"\n    },\n    \"summary\": \"Artie argues with a vending machine over a bag of chips before a freak electrical surge sends him to the great login screen in the sky.\",\n    \"threads\": [],\n    \"type\": \"setup\"\n  },\n  \"next\": {\n    \"callbacks\": [],\n    \"characters\": [\n      \"CHAR_ARTIE\",\n      \"CHAR_FIZZ\"\n    ],\n    \"introduces\": [\n      \"CHAR_FIZZ\"\n    ],\n    \"outcome\": \"Artie is locked into a 'Crit or Quit' build with 1 HP and 100% Critical Hit rate.\",\n    \"scene_id\": 2,\n    \"section\": {\n      \"intent\": \"Establish Artie's mundane life and sudden, absurd death.\",\n      \"section_id\": 1,\n      \"section_role\": \"\",\n      \"title\": \"The Exit Interview\"\n    },\n    \"summary\": \"The System, personified as a snarky UI, mocks Artie's life choices while he accidentally dumps all his points into the 'Crit' stat.\",\n    \"threads\": [\n      \"THREAD_CRIT_EXPLOIT\"\n    ],\n    \"type\": \"reveal\"\n  },\n  \"previous\": null,\n  \"scene_index\": 1,\n  \"section\": {\n    \"intent\": \"Establish Artie's mundane life and sudden, absurd death.\",\n    \"section_id\": 1,\n    \"section_role\": \"\",\n    \"title\": \"The Exit Interview\"\n  }\n}\n\n\nCharacter states (per outline_window.current.characters):\n[\n  {\n    \"character_id\": \"CHAR_ARTIE\",\n    \"containers\": [\n      {\n        \"container\": \"pockets\",\n        \"contents\": [\n          \"Smartphone (dead)\",\n          \"Wallet\"\n        ],\n        \"location\": \"legs\",\n        \"owner\": \"CHAR_ARTIE\"\n      },\n      {\n        \"container\": \"hand_right\",\n        \"contents\": [\n          \"Rusty Shortsword\"\n        ],\n        \"location\": \"arm_right\",\n        \"owner\": \"CHAR_ARTIE\"\n      }\n    ],\n    \"history\": [],\n    \"invariants\": [\n      \"inventory: CHAR_ARTIE -> Smartphone (dead) (status=stowed, container=pockets)\",\n      \"inventory: CHAR_ARTIE -> Wallet (status=stowed, container=pockets)\",\n      \"inventory: CHAR_ARTIE -> Rusty Shortsword (status=carried, container=hand_right)\",\n      \"container: pockets (owner=CHAR_ARTIE, contents=[Smartphone (dead), Wallet])\",\n      \"container: hand_right (owner=CHAR_ARTIE, contents=[Rusty Shortsword])\"\n    ],\n    \"inventory\": [\n      {\n        \"container\": \"pockets\",\n        \"item\": \"Smartphone (dead)\",\n        \"status\": \"stowed\"\n      },\n      {\n        \"container\": \"pockets\",\n        \"item\": \"Wallet\",\n        \"status\": \"stowed\"\n      },\n      {\n        \"container\": \"hand_right\",\n        \"item\": \"Rusty Shortsword\",\n        \"status\": \"carried\"\n      }\n    ],\n    \"name\": \"Arthur 'Artie' Penhaligon\",\n    \"schema_version\": \"1.0\",\n    \"updated_at\": \"2026-02-06T01:21:05Z\"\n  }\n]\n\nState:\n{\n  \"budgets\": {\n    \"max_new_entities\": 1,\n    \"max_new_threads\": 1,\n    \"max_scene_words\": 0,\n    \"min_scene_words\": 0\n  },\n  \"characters\": {\n    \"count\": 5,\n    \"status\": \"READY\",\n    \"updated_at\": \"2026-02-06T01:21:05Z\"\n  },\n  \"cursor\": {\n    \"chapter\": 0,\n    \"scene\": 0\n  },\n  \"duplication_warnings_in_row\": 0,\n  \"outline\": {\n    \"path\": \"outline/outline.json\"\n  },\n  \"schema_version\": \"1.0\",\n  \"status\": \"OUTLINED\",\n  \"summary\": {\n    \"chapter_so_far\": [],\n    \"key_facts_ring\": [],\n    \"last_scene\": [],\n    \"must_stay_true\": [],\n    \"pending_story_rollups\": [],\n    \"story_so_far\": []\n  },\n  \"world\": {\n    \"cast_present\": [],\n    \"location\": \"\",\n    \"open_threads\": [],\n    \"recent_facts\": [],\n    \"time\": {}\n  }\n}\n\nTask:\nCreate the next scene card.\n"
      }
    ]
  }
}