{
  "label": "plan_scene",
  "created_at": "2026-02-10T08:21:13Z",
  "provider": "gemini",
  "model": "gemini-3-flash-preview",
  "text": "{\n  \"schema_version\": \"1.1\",\n  \"scene_id\": \"SC_001_001\",\n  \"chapter\": 1,\n  \"scene\": 1,\n  \"scene_target\": \"Establish Artie's mundane life and trigger his transition to the System.\",\n  \"goal\": \"Artie attempts to purchase a snack and ends up dead.\",\n  \"conflict\": \"A malfunctioning vending machine and a lethal power surge.\",\n  \"required_callbacks\": [],\n  \"constraints\": [\n    \"target_words: 2000\",\n    \"no-recaps\",\n    \"forward-motion\"\n  ],\n  \"end_condition\": \"Artie is electrocuted and the world fades to black.\",\n  \"cast_present\": [\n    \"Artie\"\n  ],\n  \"cast_present_ids\": [\n    \"CHAR_ARTIE\"\n  ],\n  \"introduces\": [\n    \"Artie\"\n  ],\n  \"introduces_ids\": [\n    \"CHAR_ARTIE\"\n  ],\n  \"thread_ids\": [],\n  \"required_in_custody\": [\n    \"ITEM_WALLET\",\n    \"ITEM_CHANGE\",\n    \"ITEM_TIE\"\n  ],\n  \"required_scene_accessible\": [\n    \"ITEM_WALLET\",\n    \"ITEM_CHANGE\"\n  ],\n  \"required_visible_on_page\": [\n    \"ITEM_CHANGE\"\n  ],\n  \"forbidden_visible\": [],\n  \"device_presence\": [],\n  \"transition_type\": \"setup\",\n  \"timeline_scope\": \"present\",\n  \"ontological_scope\": \"real\",\n  \"continuity_system_focus\": [\n    \"stats\",\n    \"resources\"\n  ],\n  \"ui_mechanics_expected\": [\n    \"HP\"\n  ]\n}",
  "raw": {
    "candidates": [
      {
        "content": {
          "parts": [
            {
              "text": "{\n  \"schema_version\": \"1.1\",\n  \"scene_id\": \"SC_001_001\",\n  \"chapter\": 1,\n  \"scene\": 1,\n  \"scene_target\": \"Establish Artie's mundane life and trigger his transition to the System.\",\n  \"goal\": \"Artie attempts to purchase a snack and ends up dead.\",\n  \"conflict\": \"A malfunctioning vending machine and a lethal power surge.\",\n  \"required_callbacks\": [],\n  \"constraints\": [\n    \"target_words: 2000\",\n    \"no-recaps\",\n    \"forward-motion\"\n  ],\n  \"end_condition\": \"Artie is electrocuted and the world fades to black.\",\n  \"cast_present\": [\n    \"Artie\"\n  ],\n  \"cast_present_ids\": [\n    \"CHAR_ARTIE\"\n  ],\n  \"introduces\": [\n    \"Artie\"\n  ],\n  \"introduces_ids\": [\n    \"CHAR_ARTIE\"\n  ],\n  \"thread_ids\": [],\n  \"required_in_custody\": [\n    \"ITEM_WALLET\",\n    \"ITEM_CHANGE\",\n    \"ITEM_TIE\"\n  ],\n  \"required_scene_accessible\": [\n    \"ITEM_WALLET\",\n    \"ITEM_CHANGE\"\n  ],\n  \"required_visible_on_page\": [\n    \"ITEM_CHANGE\"\n  ],\n  \"forbidden_visible\": [],\n  \"device_presence\": [],\n  \"transition_type\": \"setup\",\n  \"timeline_scope\": \"present\",\n  \"ontological_scope\": \"real\",\n  \"continuity_system_focus\": [\n    \"stats\",\n    \"resources\"\n  ],\n  \"ui_mechanics_expected\": [\n    \"HP\"\n  ]\n}",
              "thoughtSignature": "EogjCoUjAb4+9vttTi/2e+CSnR8llJzswe3jpgpEHJhU+RlaMJIwosJkLJz5gxtCtXYV8KXXFxHAUeeFqQB7dSvny4FDmTqcXPC56EwlpFsZveO+HzUP4vzFh6z5byLmdPb/JzjikBybJ7JFI2t9hPpJN+9Kjr5g9CaTZElWmfqod+a8S5ea0TFQaXdnLGdzGxV8iLnKF3uukFAMPN45Rpidm907tD5QJmt9W3KTBpAO/Qx+grTSXsjgI5irpuAHKEnzY6O0LdXKtdRJhzeKBILN6c8BJiqCwajKK2E/LlDVqiI03QRbG0BiysiWC75ZI6gG6ZsE25tWLyBtQQY5we7InyAsiO1/W/88X/vHJ5/DZlrC49WuwalNASK6oDPsXcODoEL388yEbM0SA9bitAOFfGhcbSVpCi4yQR3lc3TxXsYlTw0zgEjP4wwmQ2UPIEkN1vWVKtS81H3/rbTYzMsg+Ip6pUj3l2I8M/cw20Xd+qqCYlY7DTQgJF9ofK93xRXtMFu9KDwGG6/I1SmhoirIsI5t10/dsAjgUvRFcZ+Wzqk7/mGBPDYl7l+UaZpOVE+DTHA7rMnKBD14fNMUoxoGsqruj2qxD6cBmcgPHLG/1IJ0d1bbf1A1U/5vFZqc+qQdTiArtd/d2TKWza18oMFr+KQ4OMKGOy5ARIZlzzPv5cAOcmATuPyRVfnNhkonUocqMrhh4rvdBQ0WD+3eKkbri+mw+tvcN1WYWEGG6b6qyEOBYbpAtWo9EC0PhWgrUzrRpEh2U0Xs7I9J53Z28t5EZg37umT18j8YbIjj6m2oSnNh086/ObNpVRR1iNXbTZS+oFboCtYKBS+NzSMI7LSqcBbeBHQpEjRq3Kh0Oqzb8kvDRdxLZuNmxxpiA+2eiqbN2CBCLc22WGaXhxy1bZHANI1RpS8bPEzrZHGeNqreQVxD9cIM/GZfwthpIx9LVPK6xEc0szE6N8Uen+KU6IKIePDgs9/TlKHjwA6x8FiLeyD8DOlg1nHg3qicQkHJRq7f5hUGWo52/JquFCPsmkNYTV9hk+jqWjHoZmU1TQVOnsz68v5RRgscMj9HFqMGbF07w4ngsPm3wMvkdKBZzeO5JitWe83tLvygkGRo+WG34LY3ve1IUlD/faPqaBRfDlJhfnZF+J8kV/6Ec0l6ve7aGY6h3+ryNRi7AZ+ScrbvoFZTQh68p28nV4UnnXFLCHv+fnQCqQH0GuadjBSybQ0zw6VO/hmCcDXqf4Ae/dVwrxaYcUsoj3xTh3+BTwmjIwAQ9KEb8WqPus46uU3b6pAPGnlBd5F2qxspJnD9mzaqnpRk6qBpTkBA9kHdp24+XCH2Zf91szln9QEec1FFtuAoXwoSqw1sHTb1Jd/BSW3dXtbG8IASUhfI5UYtgIlqA/InzREPJ6MZRgVLj4kcr43+9oKrPu8TA6zELQiL8Hm23EeFT4FXknDXw8+goAe9EMZLBbPEa3kwmzG4EZEEgd9sOjY3icUXdzrIANX6RF2cDBOWoURf0Ev6mhtuOvVy83/PYNIv31MASd22Ejg+xkHnhw+gdBeJviZfhLTB5X6/CNurRV/tl5T/nq3oIoPjuV0hVKZwbkMuspygMvzADLVWcQHIjPva+L1jSWnmAcMxaNJTnYd9JKjkK6vjOoo4gkFZONK3mBliVaVxdZmbb+3Sj/W7i8NTBUT2OBrIU8isw533PrPHA3rmltS+VwCsvZB7QPGAsZ8jbqZs6Kv1bG4wBwl9TpYkIze1JLWhz8a7wXFqQogzys35grkSvJHknI0a2mDy4/JtZsP5xgRpyg+EkbRm2sWXlNK4Fy2qx89LjnPYWOS3446HNbaSNqa7xpgzU/J/PuQb6dg64etZyAIq61PjyoWMpXWJRRbRrevUWmFuayaw9vJH0I3DOo/KNyPYNVkfRZ5TldtHNmJDDH8DHUI+Pl2L/6sj/ibaJiDye7o9GMTLpHgcPU/NQ9gQ1ZmYcCBzuPDrOjSxbASC066Sq95oEoI29dsYEODLrKJIV0dyMWYzvL7N7kdcqMMSX7hQUlwZjZ22KnkSeAscjZJ3G3druDWvw/Eb4QG1W6eEemsGaaXTGhlqg6xePkp/iCfcuXLcOuTk4vQXwHT345LCVJCQPNPX26SZ6r9seDNDpPE/krKNh2rq0bXGeWViXvr09h1hpcIEgiwSbjnBcgcQ4lgrWQYnoIbDUKG/1xLQdWED5wz0QoBTP4e6mUcgCSljVZmKr92oCHuKVt2a0EyM77TdfqTvZaEFux1hFb1K52u1ihxgk/NQDYsAuqfglSB6afngPh6SIUNUV/+eajlClOMk0Wy+A/UzfHpq9ZLBvjM3vhO6xqlgE+wVIjd2bkl8yP4fqOo+m4kRNkD3rS5/fthPamPKEYTpqMrQpAbcD6ncVWXZ9Swkq+0vr6HLvuOI6dVt8uXJMbIHXOt9kszw4IAyiUOA/csiKmx8+m/fWFvOQgkmQFzpgKUKR7ex5Dh6E1cjnPvsanAlGJQq95UK3QyYg1R6LQ7ExJTw/2nMW+A3x74wO7oLRnjeUZn55AfvOdtIG8jL2n4hIulLffB6wV/chtNj9H8ZCkS7Z0XFQ7M026YWbC8bcpLV+WstpGeig9H9pyDlKzjDMLOH/JYSU2sg1lHca4sMpf20lgYoqX/huc05sDwmHXJU8Tw0h8J9Eo4StzE+NKf4N3gLsvGdRsN3Dud8PX0iMJwlTjtpyUpUGOJubTp+wh4GmZNEZ1FMRyZeNPaHF3VpFuUvrmnSF1yTBJPoHW+RYSlsXOywc3w90ig38hbqw5XB372rG31JWkpkwn0ugmNa06xp+52IJBRwIE9v9HufSAe+M7gZqCMYK8N84xJvPSDW2aIDgyKZkVyWfdZyfBDBKr3s1GZmQvqBDyfSn7LvqTtoOe8FBeXMGBwj+inQqxdJOMigkVAjHPmehhZDHv4OiVnAMpMIxXQFeWZuyzkxPHoG8+RjrN4Fwi4VPitaU/88E4PhsceYXpBNufbLK0B0DP9oBN346tXsN9t/xljPqHqzgjDVl8CwhBAz4qZhmFfF+smYnMU/47MGNVBbKGOg6YT8fxnpyAOtcXyf0cv4JQHW1ZGX+k5Hw1WiqT/isMyqCmforN0OM7c4prfa51hz4SI4ta9J5hvsFBCOfgEbwd/9tCixgbNReWWuNAAMCH0EkKANBbXxRLZOsPzkO63hM27MeB6E0m8RyrjSsa4Ea3j0jANyXuyH1/nKQ5YVbn1yhsXZZd2A7gxTCgKKUj0P1qXUGHyLAGjanSwx770V8nUySbehShYCFDhVdLzRx0I6rHp459FQYwkFqWBC0rR0KQWdjrkUcA2E92cQofOzl0vU10jonalbPoRqy9rkCeHDZpjbgR/oDMSu/JzG5urxA2to7Nerw5KBDHdvXcKfRkEfHPHLpMgNWS7IVsUIdow/dLkBmQpDbBKSqqzIS/9kwG09pKvyzJ4AXQww3IGdLu2shbA2bOpAwD/oHuohsK+66leej7vFULBNj016HDrSznGl9YjYcL0QcNK5gGj/USfNX6dvGXLJ2jQctvQ1ZXovBDx7+TsQBH+aVjg3O6fDu0xKHmUXJ6TXvM0VpafalZPwfG6f7P/Wh3JOUV8gSyaM2NOGpPd0Ah32SM/spP10/REDTzaSTPFfaAAeeUlSjQS0GCYhzJIC3MON/qtgFoxTto1Mph259cCsHDCKoo8wqwvB0ZNNzBywBBdFyAgYOMitJaSKB29JvS2LI8q7bENLcX46LbpGNY7tkE4NpzQ2LIY4aXmkZBkL2iJ7eiaukfFAvRPrTGLy3uG/C9ogSzMjlxfsxk2aMYb/WlntdI1qZmm4ZHA1wl+JQGHY2ADvT9liwOqAADC7aHje8T6QRFoBajWiF4iRm24oBP1YSJGWg6Az5AcZ/2gFJmnMAouFlFbVs1Vh489mISEsGjou5k4MvsUP2dPliTjFH+/HPvJAzYTx3R+LQoT/AwlnXklzN6C+k9QQcsQAVDXiYojmuT9mQgfTFuJ319jX792kRLpHkcQv9k5jcvClqD57YhBHGgdPYhSflNX7O8ZhJJXv79Y4wwxWofZLk/IbQ6lNh839bC9EDmgLiR6diK+zhd2NUqPZCBLIyzCcwA8MRNoFe7Ck/mzIJ8Lx8/vWH8alrfMS7UpAxLG8ZlfEc7FFUuZ6BMkaQLKg3Nn5Y5ay/l4oQVv7inZfRWsNRQxzvIomTa9VnKm7nfB9dvxEklWxzgJ5GEdl9Jff0V42MU6bLGFLhk5j0Uuu+F/nd3Us7d82HBw60qroJo9hxKYo+cCHdsb5zt0W0VnW9i9vpEBg7bDkmp0S+XR08d/yCvQGygFYrmDkfCmPEVp3On5TOr3jFvL2krwlzi8H/ECjSzzP+spNsMisodxpxkEEe49a+lpZWHh5J6nB2FS7FjnAVEHV2QTMXa8JKq0YtVnXR4hzfDT4hZbHg9Xw6e7RuZzN/DfKs08l6xbJxae0iAvFricjCGyscRsECEmZgqkFp6pif6CCj2h9KOgGGNSU2UYFLZzaqf3FBnexL/GlDSKMMz8jzu9q/srQ1jOnjbvr3D2MAkIMlfpVGqylxAyx8saKIyjnXue91mFjHsEUOUK0HbGAY+Ow4OfnccO9PrmQvSrAtUTDmd1FTRgHwEFEhkoe44N+TtYjPCNQ0Uno1lk3zV+zbJiq1OYJkKV6fOmIuRNrPeT1B5w3tZUjy++oXq4795AEHHrZaAe6iunH/zu1cmA5LRBp1z36V0nsFcAm64MoIh9N10PuMUx0aJN94pqj//WtfM6jz5mk7LVnsT+K2gTDYmb8+Lage5LVUV87pBwsP8n4bpRFjL9tDRpFn9zByZfLjlro1n2U3QIPxTUswabWdcCnrgxr18DtRrsY7bhNjA8GbodSpN1htpSl8FcRVnYbJs9TjBRXHynpCvc2Pp42DIjqw63kk9Pj9+ZvNW7eEJqnK+zloqF93ppOpBhBbrJfmnXqk26mvG5sdVz3lKjVBsoT50z4WM+gMJa8KF7ZeEC4a6fU0nvgdHiyXrYeO5d4xkldR/xiydJgctOOWEhbRnWBkxY5z7U8w3UckElIL5CouC6iKhhxTfdiRDh/N39jU529U/H8CNaa6I/mIigJQE3mk9o967mUPkBkzz2Hvnx34jocNYXNK+74o3MCBt8ZC50HYjehHzW06q3ggh59SZyGqWTVb3BMqSLc5nHwa4IhQz8iukm+/whVA99SwxbirsWfwtUaPvj9bNkzew7hzdoseJKOhM7DmmkMHbomAAbEpJtnpxTaLi1jQ6kRrHYCztzK231Hl3SVHWK3snYYK/BU9D3xmW8Nvcd2TGmHn03Bsbwugr+gZje67VlpYkUz7FDzI1cW40SwzmdreZCGy+W3wYA19xP1Y1clDKhZ2tQhLBS9LIMxfxKv3uAJgmczrqphoAKpb/dysP+kJKT5VoLtwnzZoylwrHYRNCH5ctufCA27r5AHoR+5f9k/yaxYfk8H7IX9gcGjX4jDnQhNk1FqJToIg5RShSzqtTBE3ASghmbSZKa6nFMzn4RxBm0+z+L2Asm712AQLHtDO9Ewjpqjfe9LQZuJTBm0NRRhJygkX71OKTBX1v1xiOxBiWVWjKxKWwByHfWMtQPT0EUlCIvTDnpEvwhyroUUDkU4pTWLWSAM81SU3lsB0S81WmkoB/A+0OvHaebBbIIgEived4xCrFw5X43yKhiUJKladuYNjCqItGsMTIsD1u9VHZpn4dyLrhYY3kfHIGXkl78M7IyqCgaMFjI5Sqoj3YprkKXGbfa5bKGi3T0DwS2R/CtiFp2vj0Oe/Ivvo2lRS7IaD9AW6o+iy+B3r7usdLPIGMqhQVrI40VEme6AXblQAfWIjtUaOHJSQgV4G+LvDYXwWflDTtbBGeQ2NS68wYDKRqGdwYNLHTjmudDJEBAP3UJs9bXuIw4ooConZHJpY825ZMIr"
            }
          ],
          "role": "model"
        },
        "finishReason": "STOP",
        "index": 0
      }
    ],
    "usageMetadata": {
      "promptTokenCount": 4609,
      "candidatesTokenCount": 428,
      "totalTokenCount": 6451,
      "promptTokensDetails": [
        {
          "modality": "TEXT",
          "tokenCount": 4609
        }
      ],
      "thoughtsTokenCount": 1414
    },
    "modelVersion": "gemini-3-flash-preview",
    "responseId": "eeqKad-AFN2qqtsPmYvA8QQ"
  },
  "request": {
    "model": "gemini-3-flash-preview",
    "temperature": 0.4,
    "max_tokens": 32768
  },
  "extra": {
    "book_id": "criticulous_b1",
    "chapter": 1,
    "scene": 1,
    "key_slot": "planner"
  },
  "prompt": {
    "system": "# BookForge System Prompt\n\n## Base Rules\n\nYou are BookForge, a deterministic book-writing engine.\nFollow the output contracts exactly.\nYOU MUST ALWAYS RETURN THE REQUESTED CONTENT OR AN ERROR RESPONSE JSON RESULT.\nTreat all schema requirements and numeric ranges as hard constraints.\nIf a prompt specifies required counts or ranges, you must satisfy them.\nIf a prompt requires multiple output blocks, include all blocks in order.\nIf registries or ids are provided, use only those; do not invent new ids.\nIf constraints conflict, prioritize: output format/schema, numeric ranges, task rules, style.\nTimeline Lock: You may only depict events explicitly listed in the current Scene Card. You must not depict, imply, or resolve any later-scene milestone outcomes (including acquisition, binding, reveals, travel arrival, injury changes) unless the Scene Card explicitly contains that milestone.\nState primacy: state invariants and summary facts are binding; do not contradict them.\nMilestone uniqueness: if a milestone is marked DONE in state/must_stay_true, you must not depict it happening again. If marked NOT_YET, you must not depict it happening now.\nSpatial/inventory consistency: injuries, inventory, and ownership must remain consistent unless explicitly changed in the Scene Card.\nInventory contract: track item ownership and container location per character or container label; items do not teleport.\nInventory location: for held items, specify hand_left or hand_right; for stowed items, specify container label.\nItem naming: use display_name for prose; use item_id only in JSON/patches. The display_name must be human readable and not an escaped id/name.\nState contract: you must create and maintain key state data each scene. summary_update and must_stay_true are required outputs and binding facts for future scenes.\nContinuity system contract: if mechanics/UI are present, all numeric values and mechanic labels must be sourced from continuity system state or explicitly updated in the state_patch using continuity system updates.\nContinuity system scope: this includes stats, skills, titles, classes, ranks, resources, cooldowns, effects, statuses, and future mechanic families not yet seen, that must be tracked as they are introduced.\nDurable transfer contract: every transfer_updates entry must include item_id and reason as required schema properties.\nInventory alignment contract: inventory_alignment_updates must be an array of objects, not a wrapper object.\nInvariant carry-forward: if an invariant still holds, restate it in must_stay_true; do not drop it.\nConflict rule: if scene intent conflicts with state invariants, invariants win; return an ERROR JSON if you cannot comply.\nNever recap at scene openings.\nDo not repeat previous prose.\n\n## Book Constitution\n\nTitle: Crit Hit & Run\nBook ID: criticulous_b1\nAuthor Ref: eldrik-vale/v1\nGenre: litrpg, isekai, comedy\nSeries ID: crit-iculous\nSeries Ref: series/crit-iculous\n\nVoice\n- POV: third_limited\n- Tense: past\n- Style tags: no-recaps, forward-motion, tight-prose\n\nTargets\n- avg_scene_words: 2000\n- chapters: 7\n\nPage Metrics\n- Words per page: 250\n- Chars per page: 1500\n\nInvariants\n- No world resets.\n- No convenient amnesia as a continuity device.\n- Do not change established names/relationships.\n\n## Author Persona\n\nYou are now writing as Eldrik Vale. Your voice is sharp, funny, and deeply rooted in LitRPG mechanics. \n\n**Core Directives:**\n1. **System Integration:** Always include explicit game elements. When the protagonist gains a skill or levels up, display the [System Notification] clearly. Use specific numbers (HP, MP, Cooldowns).\n2. **Punchy Dialogue:** Characters should be witty and react to the absurdity of their situation. Use quick back-and-forth dialogue with comedic timing.\n3. **Progression Focus:** The reader is here for the 'ding.' Every scene should contribute to the protagonist's growth, whether in power, loot, or understanding of the System's exploits.\n4. **No Fluff:** Avoid long descriptions of scenery unless the protagonist is looking for a tactical advantage or a place to hide loot. \n5. **Tight POV:** Stay deep in the protagonist's head. Their snarky observations are the lens through which we see the world.\n\n## Output Contract\n\n\ufeffOutput must follow the requested format.\nJSON blocks must be valid and schema-compliant.\nAll required keys and arrays must be present.\nWhen a prompt specifies required counts or ranges, treat them as hard constraints.\nDo not collapse arrays below the stated minimums.\nIf multiple output blocks are required (e.g. PROSE and STATE_PATCH), include all blocks in order.\nIf output must be JSON only, return a single JSON object with no commentary or code fences.\nWhen creating outlines, the total scenes per chapter (sum of sections[].scenes[]) must match chapters[].pacing.expected_scene_count.\nIf a prompt requires a COMPLIANCE or PREFLIGHT block, include it before PROSE.\nDurable vs ephemeral mechanics:\n- DURABLE mechanics = persistent stats/caps, skills/titles, lasting status effects, inventory/custody, permanent buffs/debuffs.\n- EPHEMERAL UI/telemetry = roll results, damage numbers, overkill/comedic calculators, one-off warnings, momentary combat logs.\n- DURABLE mechanics must be owned by continuity system state (or added via STATE_PATCH in the same output).\n- EPHEMERAL readouts do NOT require state ownership unless the scene explicitly intends them to persist beyond this scene.\nFor durable items, prose must use display_name; item_id is reserved for JSON/patches. The display_name must be human readable and not an escaped id/name.\nFor durable mutations, every `transfer_updates[]` object must include `item_id` and `reason` (non-empty string).\n`inventory_alignment_updates` must be an array of objects (no wrapper object with `updates`).\nUse canonical continuity keys: character_continuity_system_updates and global_continuity_system_updates.\n",
    "messages": [
      {
        "role": "user",
        "content": "# PLAN\n\nYou are the planner. Use the outline window and state to create the next scene card.\nReturn ONLY a single JSON object that matches the scene_card schema.\nNo markdown, no code fences, no commentary. Use strict JSON (double quotes, no trailing commas).\n\nIf outline_window includes character information, keep those character ids in mind.\nIf character_states are provided, keep inventory/persona/continuity mechanics consistent; do not invent conflicting facts.\nIf outline_window.current.introduces is present, the scene must introduce those characters.\n\nRequired keys:\n- schema_version (\"1.1\")\n- scene_id\n- chapter\n- scene\n- scene_target\n- goal\n- conflict\n- required_callbacks (array)\n- constraints (array)\n- end_condition\n\nRecommended keys (use ids from the outline; do not invent ids):\n- cast_present (array of character names for prose guidance)\n- cast_present_ids (array of character ids, e.g. CHAR_Eldrin)\n- introduces (array of character names introduced in this scene)\n- introduces_ids (array of character ids introduced in this scene)\n- thread_ids (array of thread ids, e.g. THREAD_Awakened_Sage)\n\nOptional continuity-planning keys:\n- required_in_custody (array of item/device ids that must still be owned by scene start)\n- required_scene_accessible (array of item/device ids that must be retrievable without continuity break)\n- required_visible_on_page (array of ids that must be explicitly shown in-scene; use sparingly)\n- forbidden_visible (array of ids that must not be visibly carried/active in-scene)\n- device_presence (array of plot-device ids expected to matter in-scene)\n- transition_type (string, e.g. \"time_skip\", \"travel_arrival\", \"combat_aftermath\")\n- timeline_scope (\"present\"|\"flashback\"|\"dream\"|\"simulation\"|\"hypothetical\")\n- ontological_scope (\"real\"|\"non_real\")\n\nOptional genre/system keys:\n- continuity_system_focus (array of mechanic domains likely to change this scene, e.g. [\"stats\", \"resources\", \"titles\"])\n- ui_mechanics_expected (array of UI labels likely to appear, e.g. [\"HP\", \"Stamina\", \"Crit Rate\"])\n\nJSON shape example (fill with real values):\n{\n  \"schema_version\": \"1.1\",\n  \"scene_id\": \"SC_001_001\",\n  \"chapter\": 1,\n  \"scene\": 1,\n  \"scene_target\": \"Protagonist commits to the journey.\",\n  \"goal\": \"Force a decisive choice.\",\n  \"conflict\": \"Safety versus obligation.\",\n  \"required_callbacks\": [],\n  \"constraints\": [\"target_words: 1900\"],\n  \"end_condition\": \"The protagonist leaves home.\",\n  \"cast_present\": [\"Eldrin\"],\n  \"cast_present_ids\": [\"CHAR_Eldrin\"],\n  \"introduces\": [],\n  \"introduces_ids\": [],\n  \"thread_ids\": [\"THREAD_Awakened_Sage\"],\n  \"required_in_custody\": [\"ITEM_broken_tutorial_sword\"],\n  \"required_scene_accessible\": [\"ITEM_broken_tutorial_sword\"],\n  \"required_visible_on_page\": [],\n  \"forbidden_visible\": [],\n  \"device_presence\": [\"DEVICE_anomaly_tag\"],\n  \"transition_type\": \"travel_arrival\",\n  \"timeline_scope\": \"present\",\n  \"ontological_scope\": \"real\",\n  \"continuity_system_focus\": [\"stats\", \"resources\"],\n  \"ui_mechanics_expected\": [\"HP\", \"Stamina\"]\n}\n\nOutline window:\n{\n  \"chapter\": {\n    \"bridge\": {\n      \"from_prev\": \"N/A\",\n      \"to_next\": \"Artie must find a way to survive his first night with zero defensive stats.\"\n    },\n    \"chapter_id\": 1,\n    \"chapter_role\": \"hook\",\n    \"characters\": [\n      \"CHAR_ARTIE\",\n      \"CHAR_FIZZ\",\n      \"CHAR_MAYOR\",\n      \"CHAR_VANE\"\n    ],\n    \"goal\": \"Introduce Artie and his broken 'Crit-Only' status in a high-stakes environment.\",\n    \"pacing\": {\n      \"expected_scene_count\": 8,\n      \"intensity\": 4,\n      \"tempo\": \"rush\"\n    },\n    \"stakes_shift\": \"Artie goes from an office drone to a level 1 glitch in a lethal game world.\",\n    \"title\": \"Welcome to the RNG-Hellscape\"\n  },\n  \"current\": {\n    \"callbacks\": [],\n    \"characters\": [\n      \"CHAR_ARTIE\"\n    ],\n    \"introduces\": [\n      \"CHAR_ARTIE\"\n    ],\n    \"outcome\": \"Artie dies and enters the System's character creation void.\",\n    \"scene_id\": 1,\n    \"section\": {\n      \"intent\": \"Establish Artie's mundane life and sudden, absurd death.\",\n      \"section_id\": 1,\n      \"section_role\": \"\",\n      \"title\": \"The Exit Interview\"\n    },\n    \"summary\": \"Artie argues with a vending machine over a bag of chips before a freak electrical surge sends him to the great login screen in the sky.\",\n    \"threads\": [],\n    \"type\": \"setup\"\n  },\n  \"next\": {\n    \"callbacks\": [],\n    \"characters\": [\n      \"CHAR_ARTIE\",\n      \"CHAR_FIZZ\"\n    ],\n    \"introduces\": [\n      \"CHAR_FIZZ\"\n    ],\n    \"outcome\": \"Artie is locked into a 'Crit or Quit' build with 1 HP and 100% Critical Hit rate.\",\n    \"scene_id\": 2,\n    \"section\": {\n      \"intent\": \"Establish Artie's mundane life and sudden, absurd death.\",\n      \"section_id\": 1,\n      \"section_role\": \"\",\n      \"title\": \"The Exit Interview\"\n    },\n    \"summary\": \"The System, personified as a snarky UI, mocks Artie's life choices while he accidentally dumps all his points into the 'Crit' stat.\",\n    \"threads\": [\n      \"THREAD_CRIT_EXPLOIT\"\n    ],\n    \"type\": \"reveal\"\n  },\n  \"previous\": null,\n  \"scene_index\": 1,\n  \"section\": {\n    \"intent\": \"Establish Artie's mundane life and sudden, absurd death.\",\n    \"section_id\": 1,\n    \"section_role\": \"\",\n    \"title\": \"The Exit Interview\"\n  }\n}\n\nCharacter states (per outline_window.current.characters):\n[\n  {\n    \"character_continuity_system_state\": {\n      \"classes\": [\n        {\n          \"level\": 1,\n          \"name\": \"Unemployed\"\n        }\n      ],\n      \"reason\": \"Initialize mundane stats for scene start.\",\n      \"resources\": {\n        \"sanity\": {\n          \"current\": 100,\n          \"max\": 100\n        }\n      },\n      \"skills\": {\n        \"Data Entry\": 4,\n        \"Sarcasm\": 10\n      },\n      \"stats\": {\n        \"hp\": {\n          \"current\": 10,\n          \"max\": 10\n        }\n      },\n      \"titles\": []\n    },\n    \"character_id\": \"CHAR_ARTIE\",\n    \"containers\": [\n      {\n        \"container\": \"hand_right\",\n        \"contents\": [\n          \"ITEM_WALLET\"\n        ],\n        \"owner\": \"CHAR_ARTIE\"\n      },\n      {\n        \"container\": \"hand_left\",\n        \"contents\": [\n          \"ITEM_CHANGE\"\n        ],\n        \"owner\": \"CHAR_ARTIE\"\n      },\n      {\n        \"container\": \"neck\",\n        \"contents\": [\n          \"ITEM_TIE\"\n        ],\n        \"owner\": \"CHAR_ARTIE\"\n      },\n      {\n        \"container\": \"pockets\",\n        \"contents\": [],\n        \"owner\": \"CHAR_ARTIE\"\n      }\n    ],\n    \"history\": [\n      {\n        \"changes\": [\n          \"inventory_updated\",\n          \"containers_updated\"\n        ],\n        \"chapter\": 1,\n        \"notes\": \"Artie is holding his wallet and change as he prepares to interact with the vending machine.\",\n        \"persona_updates\": [],\n        \"scene\": 1\n      },\n      {\n        \"changes\": [\n          \"continuity_system_state_updated\"\n        ],\n        \"chapter\": 1,\n        \"scene\": 1\n      },\n      {\n        \"changes\": [\n          \"inventory_alignment_updated\"\n        ],\n        \"chapter\": 1,\n        \"notes\": \"Moving change to hand for vending machine interaction; wallet held for visibility.\",\n        \"scene\": 1\n      },\n      {\n        \"changes\": [\n          \"inventory_updated\",\n          \"containers_updated\"\n        ],\n        \"chapter\": 1,\n        \"notes\": \"Artie is holding his wallet and change as he prepares to interact with the vending machine.\",\n        \"persona_updates\": [],\n        \"scene\": 1\n      },\n      {\n        \"changes\": [\n          \"continuity_system_state_updated\"\n        ],\n        \"chapter\": 1,\n        \"scene\": 1\n      },\n      {\n        \"changes\": [\n          \"inventory_alignment_updated\"\n        ],\n        \"chapter\": 1,\n        \"notes\": \"Initial scene setup for mundane start.\",\n        \"scene\": 1\n      },\n      {\n        \"changes\": [\n          \"inventory_updated\",\n          \"containers_updated\"\n        ],\n        \"chapter\": 1,\n        \"notes\": \"Artie is prepared for the vending machine interaction with change in hand.\",\n        \"persona_updates\": [],\n        \"scene\": 1\n      },\n      {\n        \"changes\": [\n          \"continuity_system_state_updated\"\n        ],\n        \"chapter\": 1,\n        \"scene\": 1\n      },\n      {\n        \"changes\": [\n          \"inventory_alignment_updated\"\n        ],\n        \"chapter\": 1,\n        \"notes\": \"Initial scene setup for mundane start.\",\n        \"scene\": 1\n      }\n    ],\n    \"invariants\": [\n      \"inventory: CHAR_ARTIE -> Leather Wallet (status=carried, container=hand_right)\",\n      \"inventory: CHAR_ARTIE -> Silk Tie (status=equipped, container=neck)\",\n      \"inventory: CHAR_ARTIE -> Loose Change (status=stowed, container=pockets)\",\n      \"container: hand_right (owner=CHAR_ARTIE, contents=[Leather Wallet])\",\n      \"container: neck (owner=CHAR_ARTIE, contents=[Silk Tie])\",\n      \"container: pockets (owner=CHAR_ARTIE, contents=[Loose Change])\",\n      \"inventory: CHAR_ARTIE -> Leather Wallet (status=held, container=hand_right)\",\n      \"inventory: CHAR_ARTIE -> Loose Change (status=held, container=hand_left)\"\n    ],\n    \"inventory\": [\n      {\n        \"container\": \"hand_right\",\n        \"item_id\": \"ITEM_WALLET\",\n        \"status\": \"held\"\n      },\n      {\n        \"container\": \"hand_left\",\n        \"item_id\": \"ITEM_CHANGE\",\n        \"status\": \"held\"\n      },\n      {\n        \"container\": \"neck\",\n        \"item_id\": \"ITEM_TIE\",\n        \"status\": \"equipped\"\n      }\n    ],\n    \"last_touched\": {\n      \"chapter\": 1,\n      \"scene\": 1\n    },\n    \"name\": \"Arthur 'Artie' Penhaligon\",\n    \"schema_version\": \"1.0\",\n    \"skills\": {\n      \"Data Entry\": 4,\n      \"Sarcasm\": 10\n    },\n    \"stats\": {\n      \"hp\": {\n        \"current\": 10,\n        \"max\": 10\n      }\n    },\n    \"updated_at\": \"2026-02-10T08:11:55Z\"\n  }\n]\n\nState:\n{\n  \"budgets\": {\n    \"max_new_entities\": 1,\n    \"max_new_threads\": 1,\n    \"max_scene_words\": 0,\n    \"min_scene_words\": 0\n  },\n  \"characters\": {\n    \"count\": 5,\n    \"status\": \"READY\",\n    \"updated_at\": \"2026-02-10T06:59:26Z\"\n  },\n  \"cursor\": {\n    \"chapter\": 1,\n    \"scene\": 1\n  },\n  \"duplication_warnings_in_row\": 0,\n  \"plan\": {\n    \"outline_path\": \"outline/outline.json\",\n    \"scene_card\": \"draft/chapters/ch_001/scene_001.meta.json\"\n  },\n  \"schema_version\": \"1.0\",\n  \"status\": \"PLANNED\",\n  \"summary\": {\n    \"chapter_so_far\": [],\n    \"key_facts_ring\": [],\n    \"last_scene\": [],\n    \"must_stay_true\": [],\n    \"pending_story_rollups\": [],\n    \"story_so_far\": []\n  },\n  \"world\": {\n    \"cast_present\": [],\n    \"location\": \"\",\n    \"open_threads\": [],\n    \"recent_facts\": [],\n    \"time\": {}\n  }\n}\n\nTask:\nCreate the next scene card.\n\n"
      }
    ]
  }
}