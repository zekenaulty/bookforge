{
    "$schema":  "https://json-schema.org/draft/2020-12/schema",
    "title":  "State Patch",
    "type":  "object",
    "required":  [
                     "schema_version"
                 ],
    "properties":  {
                       "schema_version":  {
                                              "const":  "1.0"
                                          },
                       "world_updates":  {
                                             "type":  "object"
                                         },
                       "thread_updates":  {
                                              "type":  "array",
                                              "items":  {
                                                            "anyOf":  [
                                                                          {
                                                                              "type":  "object"
                                                                          },
                                                                          {
                                                                              "type":  "string"
                                                                          }
                                                                      ]
                                                        }
                                          },
                       "canon_updates":  {
                                             "type":  "array",
                                             "items":  {
                                                           "type":  "object"
                                                       }
                                         },
                       "cursor_advance":  {
                                              "type":  "object",
                                              "properties":  {
                                                                 "chapter":  {
                                                                                 "type":  "integer",
                                                                                 "minimum":  0
                                                                             },
                                                                 "scene":  {
                                                                               "type":  "integer",
                                                                               "minimum":  0
                                                                           }
                                                             },
                                              "additionalProperties":  true
                                          },
                       "duplication_warnings_in_row_delta":  {
                                                                 "type":  "integer"
                                                             },
                       "world":  {
                                     "type":  "object"
                                 },
                       "summary_update":  {
                                              "type":  "object",
                                              "properties":  {
                                                                 "last_scene":  {
                                                                                    "type":  "array",
                                                                                    "items":  {
                                                                                                  "type":  "string"
                                                                                              }
                                                                                },
                                                                 "key_events":  {
                                                                                    "type":  "array",
                                                                                    "items":  {
                                                                                                  "type":  "string"
                                                                                              }
                                                                                },
                                                                 "must_stay_true":  {
                                                                                        "type":  "array",
                                                                                        "items":  {
                                                                                                      "type":  "string"
                                                                                                  }
                                                                                    },
                                                                 "chapter_so_far_add":  {
                                                                                            "type":  "array",
                                                                                            "items":  {
                                                                                                          "type":  "string"
                                                                                                      }
                                                                                        },
                                                                 "story_so_far_add":  {
                                                                                          "type":  "array",
                                                                                          "items":  {
                                                                                                        "type":  "string"
                                                                                                    }
                                                                                      },
                                                                 "threads_touched":  {
                                                                                         "type":  "array",
                                                                                         "items":  {
                                                                                                       "type":  "string"
                                                                                                   }
                                                                                     }
                                                             },
                                              "additionalProperties":  true
                                          },
                       "character_updates":  {
                                                 "type":  "array",
                                                 "items":  {
                                                               "type":  "object",
                                                               "properties":  {
                                                                                  "character_id":  {
                                                                                                       "type":  "string"
                                                                                                   },
                                                                                  "chapter":  {
                                                                                                  "type":  "integer",
                                                                                                  "minimum":  0
                                                                                              },
                                                                                  "scene":  {
                                                                                                "type":  "integer",
                                                                                                "minimum":  0
                                                                                            },
                                                                                  "inventory":  {
                                                                                                    "type":  "array",
                                                                                                    "items":  {
                                                                                                                  "type":  "object"
                                                                                                              }
                                                                                                },
                                                                                  "containers":  {
                                                                                                     "type":  "array",
                                                                                                     "items":  {
                                                                                                                   "type":  "object"
                                                                                                               }
                                                                                                 },
                                                                                  "persona_updates":  {
                                                                                                          "type":  "array",
                                                                                                          "items":  {
                                                                                                                        "type":  "string"
                                                                                                                    }
                                                                                                      },
                                                                                  "invariants_add":  {
                                                                                                         "type":  "array",
                                                                                                         "items":  {
                                                                                                                       "type":  "string"
                                                                                                                   }
                                                                                                     },
                                                                                  "notes":  {
                                                                                                "type":  "string"
                                                                                            },
                                                                                  "appearance_updates":  {
                                                                                                            "type":  "object"
                                                                                                        }
                                                                              },
                                                               "required":  [
                                                                                "character_id",
                                                                                "chapter",
                                                                                "scene"
                                                                            ],
                                                               "additionalProperties":  true
                                                           }
                                             },
                       "character_continuity_system_updates":  {
                                                                   "type":  "array",
                                                                   "items":  {
                                                                                 "type":  "object",
                                                                                 "properties":  {
                                                                                                    "character_id":  {
                                                                                                                         "type":  "string"
                                                                                                                     },
                                                                                                    "set":  {
                                                                                                                "type":  "object"
                                                                                                            },
                                                                                                    "delta":  {
                                                                                                                  "type":  "object"
                                                                                                              },
                                                                                                    "remove":  {
                                                                                                                   "type":  "array",
                                                                                                                   "items":  {
                                                                                                                                 "type":  "string"
                                                                                                                             }
                                                                                                               },
                                                                                                    "reason":  {
                                                                                                                   "type":  "string"
                                                                                                               }
                                                                                                },
                                                                                 "required":  [
                                                                                                  "character_id"
                                                                                              ],
                                                                                 "additionalProperties":  true
                                                                             }
                                                               },
                       "global_continuity_system_updates":  {
                                                                "type":  "array",
                                                                "items":  {
                                                                              "type":  "object",
                                                                              "properties":  {
                                                                                                 "set":  {
                                                                                                             "type":  "object"
                                                                                                         },
                                                                                                 "delta":  {
                                                                                                               "type":  "object"
                                                                                                           },
                                                                                                 "remove":  {
                                                                                                                "type":  "array",
                                                                                                                "items":  {
                                                                                                                              "type":  "string"
                                                                                                                          }
                                                                                                            },
                                                                                                 "reason":  {
                                                                                                                "type":  "string"
                                                                                                            }
                                                                                             },
                                                                              "additionalProperties":  true
                                                                          }
                                                            },
                       "character_stat_updates":  {
                                                      "type":  "array",
                                                      "items":  {
                                                                    "type":  "object",
                                                                    "properties":  {
                                                                                       "character_id":  {
                                                                                                            "type":  "string"
                                                                                                        },
                                                                                       "set":  {
                                                                                                   "type":  "object"
                                                                                               },
                                                                                       "delta":  {
                                                                                                     "type":  "object"
                                                                                                 },
                                                                                       "reason":  {
                                                                                                      "type":  "string"
                                                                                                  }
                                                                                   },
                                                                    "required":  [
                                                                                     "character_id"
                                                                                 ],
                                                                    "additionalProperties":  true
                                                                }
                                                  },
                       "character_skill_updates":  {
                                                       "type":  "array",
                                                       "items":  {
                                                                     "type":  "object",
                                                                     "properties":  {
                                                                                        "character_id":  {
                                                                                                             "type":  "string"
                                                                                                         },
                                                                                        "set":  {
                                                                                                    "type":  "object"
                                                                                                },
                                                                                        "delta":  {
                                                                                                      "type":  "object"
                                                                                                  },
                                                                                        "reason":  {
                                                                                                       "type":  "string"
                                                                                                   }
                                                                                    },
                                                                     "required":  [
                                                                                      "character_id"
                                                                                  ],
                                                                     "additionalProperties":  true
                                                                 }
                                                   },
                       "run_stat_updates":  {
                                                "type":  "object",
                                                "properties":  {
                                                                   "set":  {
                                                                               "type":  "object"
                                                                           },
                                                                   "delta":  {
                                                                                 "type":  "object"
                                                                             },
                                                                   "reason":  {
                                                                                  "type":  "string"
                                                                              }
                                                               },
                                                "additionalProperties":  true
                                            },
                       "run_skill_updates":  {
                                                 "type":  "object",
                                                 "properties":  {
                                                                    "set":  {
                                                                                "type":  "object"
                                                                            },
                                                                    "delta":  {
                                                                                  "type":  "object"
                                                                              },
                                                                    "reason":  {
                                                                                   "type":  "string"
                                                                               }
                                                                },
                                                 "additionalProperties":  true
                                             },
                       "inventory_alignment_updates":  {
                                                           "type":  "array",
                                                           "items":  {
                                                                         "type":  "object",
                                                                         "properties":  {
                                                                                            "set":  {
                                                                                                        "type":  "object"
                                                                                                    },
                                                                                            "delta":  {
                                                                                                          "type":  "object"
                                                                                                      },
                                                                                            "remove":  {
                                                                                                           "type":  "array",
                                                                                                           "items":  {
                                                                                                                         "type":  "string"
                                                                                                                     }
                                                                                                       },
                                                                                            "reason":  {
                                                                                                           "type":  "string"
                                                                                                       },
                                                                                            "reason_category":  {
                                                                                                                    "type":  "string"
                                                                                                                },
                                                                                            "expected_before":  {
                                                                                                                    "type":  "object"
                                                                                                                }
                                                                                        },
                                                                         "additionalProperties":  true
                                                                     }
                                                       },
                       "item_registry_updates":  {
                                                     "type":  "array",
                                                     "items":  {
                                                                   "type":  "object",
                                                                   "properties":  {
                                                                                      "item_id":  {
                                                                                                      "type":  "string"
                                                                                                  },
                                                                                      "set":  {
                                                                                                  "type":  "object"
                                                                                              },
                                                                                      "delta":  {
                                                                                                    "type":  "object"
                                                                                                },
                                                                                      "remove":  {
                                                                                                     "type":  "array",
                                                                                                     "items":  {
                                                                                                                   "type":  "string"
                                                                                                               }
                                                                                                 },
                                                                                      "reason":  {
                                                                                                     "type":  "string"
                                                                                                 },
                                                                                      "reason_category":  {
                                                                                                              "type":  "string"
                                                                                                          },
                                                                                      "expected_before":  {
                                                                                                              "type":  "object"
                                                                                                          }
                                                                                  },
                                                                   "required":  [
                                                                                    "item_id"
                                                                                ],
                                                                   "additionalProperties":  true
                                                               }
                                                 },
                       "plot_device_updates":  {
                                                   "type":  "array",
                                                   "items":  {
                                                                 "type":  "object",
                                                                 "properties":  {
                                                                                    "device_id":  {
                                                                                                      "type":  "string"
                                                                                                  },
                                                                                    "set":  {
                                                                                                "type":  "object"
                                                                                            },
                                                                                    "delta":  {
                                                                                                  "type":  "object"
                                                                                              },
                                                                                    "remove":  {
                                                                                                   "type":  "array",
                                                                                                   "items":  {
                                                                                                                 "type":  "string"
                                                                                                             }
                                                                                               },
                                                                                    "reason":  {
                                                                                                   "type":  "string"
                                                                                               },
                                                                                    "reason_category":  {
                                                                                                            "type":  "string"
                                                                                                        },
                                                                                    "expected_before":  {
                                                                                                            "type":  "object"
                                                                                                        }
                                                                                },
                                                                 "required":  [
                                                                                  "device_id"
                                                                              ],
                                                                 "additionalProperties":  true
                                                             }
                                               },
                       "transfer_updates":  {
                                                "type":  "array",
                                                "items":  {
                                                              "type":  "object",
                                                              "properties":  {
                                                                                 "item_id":  {
                                                                                                 "type":  "string"
                                                                                             },
                                                                                 "transfer_chain":  {
                                                                                                        "type":  "array",
                                                                                                        "items":  {
                                                                                                                      "type":  "object"
                                                                                                                  }
                                                                                                    },
                                                                                 "from":  {
                                                                                              "type":  "object"
                                                                                          },
                                                                                 "to":  {
                                                                                            "type":  "object"
                                                                                        },
                                                                                 "reason":  {
                                                                                                "type":  "string"
                                                                                            },
                                                                                 "reason_category":  {
                                                                                                         "type":  "string"
                                                                                                     },
                                                                                 "expected_before":  {
                                                                                                         "type":  "object"
                                                                                                     }
                                                                             },
                                                              "required":  [
                                                                               "item_id",
                                                                               "reason"
                                                                           ],
                                                              "additionalProperties":  true
                                                          }
                                            }
                   },
    "additionalProperties":  true
}

